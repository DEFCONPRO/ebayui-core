var m=Object.defineProperty;var f=(i,e,s)=>e in i?m(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var n=(i,e,s)=>(f(i,typeof e!="symbol"?e+"":e,s),s);const l={};function g(i,e){return new Promise((s,t)=>{const o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=i,r.onreadystatechange=()=>{s(void 0)},r.onload=()=>{s(void 0)},r.onerror=()=>{t(),delete l[e]},o.appendChild(r)})}function c(i,e,s){return new Promise((t,o)=>{const r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("script");a.src=i,s&&(a.type=s),a.onload=()=>{t(void 0)},a.onerror=()=>{o(),delete l[e]},r.appendChild(a)})}function y(i){return new Promise(e=>{const s=`importScripts( "${i}" );`,t=document.head||document.getElementsByTagName("head")[0],o=document.createElement("noscript");o.textContent=s,o.id="restar-worker",t.appendChild(o),e(void 0)})}function d(i,e,s,t){if(i[t]){if(i[t]==="css")return g(s,e);if(i[t]==="restar-worker")return y(s);if(i[t]==="module")return c(s,e,"module")}return c(s,e)}function T(i,e,s){const t=i.join(",");return l[t]||(s?l[t]=i.reduce((o,r,a)=>o.then(()=>d(e,t,r,a)),Promise.resolve()):l[t]=Promise.all(i.map((o,r)=>d(e,t,o,r)))),l[t]}const p="4.3.2",C="10.2.1",w="2.1.1",E={"//":"This is a generated file. Run generateCDN script file to update",shaka:p,highcharts:C,modelViewer:w},D=3;class _{constructor(e,{key:s,files:t,types:o,setLoading:r,handleSuccess:a,handleError:h,stagger:u}){n(this,"self");n(this,"retryTimes");n(this,"setLoading");n(this,"handleError");n(this,"handleSuccess");n(this,"files");n(this,"types");n(this,"key");n(this,"stagger");n(this,"cdnFiles");n(this,"url");n(this,"isLoaded");n(this,"loadDelay");n(this,"retryTimeout");this.self=e,this.retryTimes=0,this.setLoading=r,this.handleError=h,this.handleSuccess=a,this.files=t,this.types=o,this.key=s,this.stagger=!!u,this._setFiles()}setOverrides(e,s){return this._setFiles(e,s),this}_setFiles(e,s){this.cdnFiles=[],this.url=`https://ir.ebaystatic.com/cr/v/c1/ebayui/${this.key}/v${s||E[this.key]}`;for(let t=0;t<this.files.length;t++)e&&e[t]?this.cdnFiles[t]=e[t]:this.cdnFiles[t]=`${this.url}/${this.files[t]}`}mount(){this.isLoaded=!1,document.readyState==="complete"?this.loadCDN():this.self.subscribeTo(window).once("load",this.loadCDN.bind(this))}loadCDN(){const e=window.requestIdleCallback||function(t,o){return setTimeout(()=>{t()},o.timeout)},s=window.cancelIdleCallback||function(t){clearTimeout(t)};this.retryTimes=0,this.setLoading(!1),s(this.loadDelay),this.setLoading(!0),this.loadDelay=e(()=>this._loadCDN(),{timeout:100})}_catchError(e){clearTimeout(this.retryTimeout),this.retryTimes+=1,this.retryTimes<D?this.retryTimeout=setTimeout(()=>this._loadCDN(),2e3):(this.setLoading(!1),this.handleError(e))}_loadCDN(){T(this.cdnFiles??[],this.types,this.stagger).then(()=>{this.setLoading(!1),this.handleSuccess()}).catch(e=>{this._catchError(e)})}}export{_ as C};
